<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pazaak</title>
    <link rel="stylesheet" href="css/estilos-gerais.css">
    <link rel="stylesheet" href="css/pazaak.css">
    <script src="js/funcoes.js"></script>
</head>

<body>
    <!--HEADER-->
    <header>
        <div class="container">
            <div class="titulo">
                <h1>STAR WARS</h1>
            </div>

            <div class="navegacao">
                <ul>
                    <li><a href="personagem.html">Personagem</a></li>
                    <li>|</li>
                    <li class="agora"><a href="pazaak.html">Pazaak</a></li>
                    <li>|</li>
                    <li onclick="limparSessao()"><a href="login.html">Sair</a></li>
                </ul>
            </div>
        </div>
    </header>

    <main>
        <div class="tituloJogo">
            <h1>PAZAAK</h1>
        </div>
        <div class="jogo">
            <div class="info">
                <p>Um jogo que remonta aos tempos da República Velha , era um popular jogo de cartas em que o objetivo
                    era chegar mais perto de 20 sem ultrapassar. O jogador com a maior pontuação menor ou igual a 20
                    venceu a rodada.</p>
            </div>
            <div class="atualizacao">
                Vitória: <span style="color: green;" id="span_vitoria">0</span> || Empates: <span style="color: yellow;" id="span_empate">0</span> || Derrotas: <span
                  style="color: red;"  id="span_derrota">0</span>
            </div>
            <div class="botao">
                <button id="botao_iniciar" class="botao_inicia" onclick="iniciarJogo()">Iniciar</button>
                <button style="display: none;" id="botao_comprar" class="botao_inicia"
                    onclick="comprarCarta()">Comprar</button>
                <button style="display: none;" id="botao_parar" class="botao_inicia"
                    onclick="pararJogo()">Parar</button>
            </div>
        </div>

        <div class="containerJogo">
            <div class="informacaoJogadores">
                <div class="usuario" style="margin-right: 20px;">
                    <div class="infoJogador">
                        <span id="span_nomeUsuario"></span> | Pontos: <br> <span id="span_pontosUsuario"> 0 </span> <br>
                        Status: <span id="span_statusUsuario">Em espera</span>
                    </div>
                    <div class="jogatina">
                        <div class="columa">
                            <img id="usuario_jogada1" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="usuario_jogada2" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="usuario_jogada3" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        </div>
                        <div class="columa">
                            <img id="usuario_jogada4" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="usuario_jogada5" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="usuario_jogada6" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        </div>
                        <div class="columa">
                            <img id="usuario_jogada7" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="usuario_jogada8" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="usuario_jogada9" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        </div>
                    </div>
                    <div class="columa1" id="columaUsuario">
                    </div>
                </div>
                <div class="usuario">
                    <div class="infoBot">
                        <span id="span_nomeBot">Bot</span> | Pontos: <br><span id="span_pontosBot"> 0 </span> <br>
                        Status: <span id="span_statusBot">Em espera</span>
                    </div>
                    <div class="jogatina">
                        <div class="columa">
                            <img id="bot_jogada1" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="bot_jogada2" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="bot_jogada3" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        </div>
                        <div class="columa">
                            <img id="bot_jogada4" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="bot_jogada5" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="bot_jogada6" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        </div>
                        <div class="columa">
                            <img id="bot_jogada7" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="bot_jogada8" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                            <img id="bot_jogada9" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        </div>
                    </div>
                    <div class="columa1" id="columaBot">
                        <img id="bot_compra1" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        <img id="bot_compra2" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                        <img id="bot_compra3" src="assets/cartas/cartaVirada.png" style="width: 85px;">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tituloJogo">
            <h1>Ranking</h1>
        </div>

        <div style="margin: 20px 30px;" class="atualizacao" id="ranking">
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="informacoes">
                <p>Usuarios <br>
                    cadastrados: <span id="qtd_usuarios">0</span></p> <br>
                <p>Hora atual: <span id="horas_atual"></span></p>
            </div>
            <div class="direitos">
                <p>Samuel Lima Ribeiro &copy; 2022 todos os direitos reservados</p>
            </div>
        </div>
    </footer>
</body>

</html>

<script>
    let proximaAtualizacao;
    window.onload = obterNumerosUsarios();
    window.onload = obterHoraAtual();
    window.onload = obterRanking();


    span_nomeUsuario.innerHTML = sessionStorage.NOME_USUARIO
    span_vitoria.innerHTML = sessionStorage.VITORIA_USUARIO
    span_empate.innerHTML = sessionStorage.EMPATE_USUARIO
    span_derrota.innerHTML = sessionStorage.DERROTA_USUARIO

    // JOGO
    const cartas_compradas = [
        { valor: 2, imagem: "assets/cartas/neutro2.png" }, { valor: 2, imagem: "assets/cartas/neutro2.png" }, { valor: 3, imagem: "assets/cartas/neutro3.png" }, { valor: 4, imagem: "assets/cartas/neutro4.png" }, { valor: 5, imagem: "assets/cartas/neutro5.png" }, { valor: 6, imagem: "assets/cartas/neutro6.png" }, { valor: 7, imagem: "assets/cartas/neutro7.png" }, { valor: 8, imagem: "assets/cartas/neutro8.png" }, { valor: 9, imagem: "assets/cartas/neutro9.png" }, { valor: 10, imagem: "assets/cartas/neutro10.png" }
    ]

    const cartas_iniciadas = [
        { valor: 1, imagem: "assets/cartas/+1.png", funcao: "carta_maisUm()" }, { valor: 2, imagem: "assets/cartas/+2.png", funcao: "carta_maisDois()" }, { valor: 3, imagem: "assets/cartas/+3.png", funcao: "carta_maisTres()" },
        { valor: 4, imagem: "assets/cartas/+4.png", funcao: "carta_maisQuatro()" }, { valor: 5, imagem: "assets/cartas/+5.png", funcao: "carta_maisCinco()" }, { valor: -1, imagem: "assets/cartas/-1.png", funcao: "carta_menosUm()" }, { valor: -2, imagem: "assets/cartas/-2.png", funcao: "carta_menosDois()" }, { valor: -3, imagem: "assets/cartas/-3.png", funcao: "carta_menosTres()" }, { valor: -4, imagem: "assets/cartas/-4.png", funcao: "carta_menosQuatro()" }, { valor: -5, imagem: "assets/cartas/-5.png", funcao: "carta_menosCinco()" }
    ]

    const div_jogadas = [{ usuario: usuario_jogada1, Bott: bot_jogada1 }, { usuario: usuario_jogada2, Bott: bot_jogada2 }, { usuario: usuario_jogada3, Bott: bot_jogada3 }, { usuario: usuario_jogada4, Bott: bot_jogada4 }, { usuario: usuario_jogada5, Bott: bot_jogada5 }, { usuario: usuario_jogada6, Bott: bot_jogada6 }, { usuario: usuario_jogada7, Bott: bot_jogada7 }, { usuario: usuario_jogada8, Bott: bot_jogada8 }, { usuario: usuario_jogada9, Bott: bot_jogada9 }]


    var lista_compras = []

    var jogadaUsuario = 0
    var jogadaBot = 0

    var pontosBot = 0
    var pontosUsuario = 0

    var jogadorParou = false
    var botParou = false

    var vezJogador = true
    var vezBot = false

    var travarValidacao = false


    // dados para cartas compradas
    var cartaJogadaComprada = false
    var valorCartaJogada = 0
    var posicaoCarta = 0
    var divCartaComprada = ""
    var imagemCarta = ""

    // FUNCAO PRA VERIFICAR SE OS DOIS PARARAM AI EU DO O RESULTO

    function iniciarJogo() {
        cadastrarJogo()
        botao_iniciar.style.display = "none"

        columaUsuario.style.display = "block"
        columaBot.style.display = "block"

        botao_comprar.style.display = "block"
        botao_parar.style.display = "block"

        span_statusUsuario.innerHTML = "Sua vez"
        span_statusUsuario.style.color = "green"
        span_statusBot.innerHTML = "Em espera"

        span_pontosUsuario.innerHTML = 0
        span_pontosBot.innerHTML = 0

        for (var contador = 0; contador < 3; contador++) {
            var numero_aleatorio = Math.floor(Math.random() * 10)
            var imagem_carta = cartas_iniciadas[numero_aleatorio].imagem
            var funcao_carta = cartas_iniciadas[numero_aleatorio].funcao

            var botaoCompra = `<button onclick="${funcao_carta}"><img src="${imagem_carta}" style="width: 85px;" alt=""> </button>`

            var jsonCarta = {
                imagem: botaoCompra,
                funcao: funcao_carta,
                imagem: imagem_carta
            }

            lista_compras.push(jsonCarta)

            columaUsuario.innerHTML += `<button onclick="${funcao_carta}"><img src="${imagem_carta}" style="width: 85px;" alt=""> </button>`
        }
    }

    function comprarCarta() {

        // carta comprada
        if (cartaJogadaComprada) {
            jogadaUsuario += 1

            var div_jogada = div_jogadas[jogadaUsuario - 1].usuario

            var numero_aleatorio = valorCartaJogada
            pontosUsuario += valorCartaJogada


            div_jogada.src = imagemCarta
            span_pontosUsuario.innerHTML = pontosUsuario

            lista_compras[posicaoCarta].imagem = "assets/cartas/cartaVirada.png"
            lista_compras[posicaoCarta].funcao = ""

            columaUsuario.innerHTML = ""
            for (var contador = 0; contador < lista_compras.length; contador++) {
                var cartaComprada = lista_compras[contador].imagem
                var funcao_carta = lista_compras[contador].funcao

                columaUsuario.innerHTML += `<button onclick="${funcao_carta}"><img src="${cartaComprada}" style="width: 85px;" alt=""> </button>`
            }

            cartaJogadaComprada = false
            valorCartaJogada = 0
            imagemCarta = ""
        } else {
            // nao parei entao posso comprar
            if (!jogadorParou && vezJogador) {
                jogadaUsuario += 1
                var div_jogada = div_jogadas[jogadaUsuario - 1].usuario
                var numero_aleatorio = Math.floor(Math.random() * 10)
                pontosUsuario += cartas_compradas[numero_aleatorio].valor

                div_jogada.src = cartas_compradas[numero_aleatorio].imagem
                span_pontosUsuario.innerHTML = pontosUsuario
                if (!botParou) {
                    // funcoes para chamar o bot
                    if (pontosUsuario > 20) {
                        span_statusUsuario.innerHTML = "Perdeu"
                        span_statusUsuario.style.color = "red"
                        span_statusBot.innerHTML = "Ganhou"
                        span_statusBot.style.color = "green"

                        setTimeout(() => derrota(), 1000)
                    } else if (pontosUsuario == 20) {
                        span_statusUsuario.innerHTML = "Parou"
                        span_statusUsuario.style.color = "yellow"

                        jogadorParou = true

                        span_statusBot.innerHTML = "Jogando"
                        span_statusBot.style.color = "green"
                        setTimeout(() => comprarCartaBot(), 1000)
                    } else if (pontosUsuario < 20) {
                        span_statusUsuario.innerHTML = "Em espera"
                        span_statusUsuario.style.color = "white"
                        span_statusBot.innerHTML = "Jogando"
                        span_statusBot.style.color = "green"

                        vezJogador = false

                        setTimeout(() => comprarCartaBot(), 1000)
                    }
                }
                //  vezJogador // funcoes sem chamar o bot
                else if (botParou) {
                    if (pontosUsuario > 20) {
                        span_statusUsuario.innerHTML = "Perdeu"
                        span_statusUsuario.style.color = "red"
                        span_statusBot.innerHTML = "Ganhou"
                        span_statusBot.style.color = "green"

                        setTimeout(() => derrota(), 1000)
                    } else if (pontosUsuario == 20 && pontosBot == 20) {
                        span_statusUsuario.innerHTML = "Empate"
                        span_statusUsuario.style.color = "yellow"
                        span_statusBot.innerHTML = "Empate"
                        span_statusBot.style.color = "yellow"

                        setTimeout(() => empate(), 1000)
                    } else if (pontosUsuario == 20) {
                        span_statusUsuario.innerHTML = "Ganhou"
                        span_statusUsuario.style.color = "green"
                        span_statusBot.innerHTML = "Perdeu"
                        span_statusBot.style.color = "red"

                        setTimeout(() => vitoria(), 1000)
                    } else if (pontosUsuario < 20) {
                        span_statusUsuario.innerHTML = "Sua vez"
                        span_statusUsuario.style.color = "green"
                    }
                }
            }
        }
    }

    function comprarCartaBot() {

        // VERIFICOU SE ELE PAROU, CASO SIM, CHAMO O BOT DNV
        // CASO CONTRARIO N ME CHAMO
        // NO FINAL EU VEJO OQ O BOT FAZ, PARA OU

        if (!botParou) {

            if (pontosBot > pontosUsuario && jogadorParou) {
                span_statusBot.innerHTML = "Ganhou"
                span_statusBot.style.color = "green"
                span_statusUsuario.innerHTML = "Perdeu"
                span_statusUsuario.style.color = "red"

                travarValidacao = true
                setTimeout(() => vitoria(), 1000)
            } else {
                jogadaBot += 1
                var div_jogada = div_jogadas[jogadaBot - 1].Bott

                var numero_aleatorio = Math.floor(Math.random() * 10)

                pontosBot += cartas_compradas[numero_aleatorio].valor

                div_jogada.src = cartas_compradas[numero_aleatorio].imagem
                span_pontosBot.innerHTML = pontosBot
            }


            // jogador parou, chamo eu mesmo e ja posso fazer o update
            if (jogadorParou && !travarValidacao) {
                if (pontosBot > 20) {
                    span_statusBot.innerHTML = "Perdeu"
                    span_statusBot.style.color = "red"
                    span_statusUsuario.innerHTML = "Ganhou"
                    span_statusUsuario.style.color = "green"


                    setTimeout(() => vitoria(), 1000)
                } else if (pontosBot == 20 && pontosUsuario == 20) {
                    span_statusUsuario.innerHTML = "Empate"
                    span_statusUsuario.style.color = "yellow"
                    span_statusBot.innerHTML = "Empate"
                    span_statusBot.style.color = "yellow"


                    setTimeout(() => empate(), 1000)
                } else if (pontosBot == 20) {
                    span_statusUsuario.innerHTML = "Perdeu"
                    span_statusUsuario.style.color = "red"
                    span_statusBot.innerHTML = "Ganhou"
                    span_statusBot.style.color = "green"

                    setTimeout(() => derrota(), 1000)
                } else if (pontosBot > pontosUsuario) {
                    span_statusUsuario.innerHTML = "Perdeu"
                    span_statusUsuario.style.color = "red"
                    span_statusBot.innerHTML = "Ganhou"
                    span_statusBot.style.color = "green"

                    setTimeout(() => derrota(), 1000)
                } else if (pontosBot == pontosUsuario && pontosBot > 16) {
                    span_statusUsuario.innerHTML = "Empate"
                    span_statusUsuario.style.color = "yellow"
                    span_statusBot.innerHTML = "Empate"
                    span_statusBot.style.color = "yellow"

                    setTimeout(() => empate(), 1000)
                } else if (pontosBot <= pontosUsuario) {
                    span_statusBot.innerHTML = "Jogando"
                    span_statusBot.style.color = "green"
                    setTimeout(() => comprarCartaBot(), 1000)
                }
            }
            // se jogador n parou, n chamo ninguem 
            else {

                if (pontosBot > 20) {
                    span_statusBot.innerHTML = "Perdeu"
                    span_statusBot.style.color = "red"
                    span_statusUsuario.innerHTML = "Ganhou"
                    span_statusUsuario.style.color = "green"


                    setTimeout(() => vitoria(), 1000)
                } else if (pontosBot == 20) {
                    span_statusBot.innerHTML = "Parou"
                    span_statusBot.style.color = "yellow"
                    span_statusUsuario.innerHTML = "Sua vez"
                    span_statusUsuario.style.color = "green"

                    botParou = true
                    vezJogador = true
                } else if (pontosBot >= 17) {
                    botParou = true

                    vezJogador = true
                    span_statusBot.innerHTML = "Parou"
                    span_statusBot.style.color = "yellow"
                    span_statusUsuario.innerHTML = "Sua vez"
                    span_statusUsuario.style.color = "green"
                } else {
                    span_statusBot.innerHTML = "Em espera"
                    span_statusBot.style.color = "white"
                    span_statusUsuario.innerHTML = "Sua vez"
                    span_statusUsuario.style.color = "green"
                    vezJogador = true
                }
            }
        }


    }

    function pararJogo() {
        jogadorParou = true

        if (botParou) {

            // VERIFICO OS NUMEROS
            if (pontosBot == pontosUsuario) {
                span_statusBot.innerHTML = "Empate"
                span_statusBot.style.color = "yellow"
                span_statusUsuario.innerHTML = "Empate"
                span_statusUsuario.style.color = "yellow"

                setTimeout(() => empate(), 1000)
            } else if (pontosUsuario > pontosBot) {

                span_statusBot.innerHTML = "Perdeu"
                span_statusBot.style.color = "red"
                span_statusUsuario.innerHTML = "Ganhou"
                span_statusUsuario.style.color = "green"

                setTimeout(() => vitoria(), 1000)
            } else if (pontosBot > pontosUsuario) {

                span_statusUsuario.innerHTML = "Perdeu"
                span_statusUsuario.style.color = "red"
                span_statusBot.innerHTML = "Ganhou"
                span_statusBot.style.color = "green"

                setTimeout(() => derrota(), 1000)
            }

        } else {
            span_statusUsuario.innerHTML = "Parou"
            span_statusUsuario.style.color = "yellow"
            setTimeout(() => comprarCartaBot(), 1000)
        }
    }

    // FUNCOES DAS CARTAS COMPRADAS

    function carta_maisUm() {
        valorCartaJogada = 1

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_maisUm()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_maisDois() {
        valorCartaJogada = 2

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_maisDois()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_maisTres() {
        valorCartaJogada = 3

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_maisTres()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_maisQuatro() {
        valorCartaJogada = 4

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_maisQuatro()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_maisCinco() {
        valorCartaJogada = 5

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_maisCinco()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_menosUm() {
        valorCartaJogada = -1

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_menosUm()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_menosDois() {
        valorCartaJogada = -2

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_menosDois()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_menosTres() {
        valorCartaJogada = -3

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_menosTres()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_menosQuatro() {
        valorCartaJogada = -4

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_menosQuatro()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    function carta_menosCinco() {
        valorCartaJogada = -5

        for (var contador = 0; contador < lista_compras.length; contador++) {

            if (lista_compras[contador].funcao == "carta_menosCinco()") {
                posicaoCarta = contador
                imagemCarta = lista_compras[contador].imagem
            }
        }

        cartaJogadaComprada = true
        comprarCarta()
    }

    // FUNCOES PARA ATUALIZAR VITORIA, EMPATE, DERROTA
    function vitoria() {
        sessionStorage.VITORIA_USUARIO = Number(sessionStorage.VITORIA_USUARIO) + 1
        fetch(`/avisos/vitoria/${sessionStorage.getItem("ID_USUARIO")}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                vitoria: sessionStorage.VITORIA_USUARIO
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                alert("Você ganhou!")
                window.location = "pazaak.html"
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    function empate() {
        sessionStorage.EMPATE_USUARIO = Number(sessionStorage.EMPATE_USUARIO) + 1
        fetch(`/avisos/empate/${sessionStorage.getItem("ID_USUARIO")}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                empate: sessionStorage.EMPATE_USUARIO
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                alert("Você empatou!")
                window.location = "pazaak.html"
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    function derrota() {
        sessionStorage.DERROTA_USUARIO = Number(sessionStorage.DERROTA_USUARIO) + 1
        fetch(`/avisos/derrota/${sessionStorage.getItem("ID_USUARIO")}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                derrota: sessionStorage.DERROTA_USUARIO
            })
        }).then(function (resposta) {

            if (resposta.ok) {
                alert("Você perdeu!")
                window.location = "pazaak.html"
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    //FUNCAO RANKING
function obterRanking(idSensor) {

    if (proximaAtualizacao != undefined) {
        clearTimeout(proximaAtualizacao);
    }
    
    fetch(`/medidas/ranking/${idSensor}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                resposta.reverse();
    
                plotarRanking(resposta);
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
        .catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }
    
    function plotarRanking(resposta, idSensor) {
    var contador = 1
          for (i = 0; i < resposta.length; i++) {
              var registro = resposta[i];
              var usuario = registro.usuario
              var vitoria = registro.vitoria
              var empate = registro.empate
              var derrota = registro.derrota

              ranking.innerHTML += `#${contador} || ${usuario} || Vitórias: <span style="color: green;"> ${vitoria} </span> || Empates: <span style="color: yellow;"> ${empate} </span> || Derrotas: <span style="color: red;"> ${derrota} </span> <br> <br>`
              contador += 1
          }  
      }
</script>